<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>N0rb1n</title>
    <style>
        /* Base styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Courier New', monospace;
        }
        
        body {
            background-color: #0a0a0a;
            color: #fff;
            overflow-x: hidden;
        }
        
        /* Navigation bar with glow effect */
        .navbar {
            background-color: #111;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #333;
            position: relative;
            z-index: 1000;
        }
        
        .site-title {
            color: #ff0000;
            font-size: 28px;
            font-weight: bold;
            text-shadow: 0 0 10px #ff0000, 0 0 20px #ff0000, 0 0 30px #ff0000;
            animation: glow 1.5s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from {
                text-shadow: 0 0 5px #ff0000, 0 0 10px #ff0000;
            }
            to {
                text-shadow: 0 0 10px #ff0000, 0 0 20px #ff0000, 0 0 30px #ff3333;
            }
        }
        
        .online-indicator {
            display: flex;
            align-items: center;
        }
        
        .dot {
            width: 12px;
            height: 12px;
            background-color: #00ff00;
            border-radius: 50%;
            margin-right: 8px;
            box-shadow: 0 0 8px #00ff00;
        }
        
        /* Menu styles */
        .menu-container {
            position: absolute;
            top: 100%;
            left: 0;
            width: 100%;
            background-color: #1a1a1a;
            overflow: hidden;
            max-height: 0;
            transition: max-height 0.5s ease-out;
            z-index: 999;
        }
        
        .menu-container.open {
            max-height: 300px;
        }
        
        .menu-toggle {
            background: none;
            border: none;
            color: #fff;
            font-size: 24px;
            cursor: pointer;
        }
        
        .menu {
            list-style: none;
            padding: 20px;
        }
        
        .menu li {
            margin-bottom: 15px;
        }
        
        .menu a {
            color: #fff;
            text-decoration: none;
            font-size: 18px;
            transition: color 0.3s;
            display: block;
            padding: 5px 0;
        }
        
        .menu a:hover {
            color: #ff0000;
        }
        
        .device-info {
            padding: 10px 20px;
            background-color: #222;
            font-size: 14px;
            color: #aaa;
            border-top: 1px solid #333;
        }
        
        /* Content sections */
        .content-section {
            display: none;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .content-section.active {
            display: block;
        }
        
        /* Home page styles */
        .search-container {
            margin-bottom: 30px;
        }
        
        .search-box {
            width: 100%;
            padding: 12px 20px;
            background-color: #222;
            border: 1px solid #333;
            color: #fff;
            border-radius: 4px;
            font-size: 16px;
        }
        
        .search-results {
            margin-top: 20px;
        }
        
        .paste-item {
            background-color: #1a1a1a;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 4px;
            border-left: 3px solid #ff0000;
        }
        
        .paste-title {
            font-size: 18px;
            margin-bottom: 8px;
        }
        
        .paste-preview {
            color: #aaa;
            margin-bottom: 10px;
            max-height: 100px;
            overflow: hidden;
        }
        
        .btn {
            padding: 8px 15px;
            background-color: #ff0000;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .btn:hover {
            background-color: #ff3333;
        }
        
        .recent-pastes {
            margin-top: 30px;
        }
        
        /* Paste creation form */
        .paste-form {
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #aaa;
        }
        
        .form-control {
            width: 100%;
            padding: 10px;
            background-color: #222;
            border: 1px solid #333;
            color: #fff;
            border-radius: 4px;
        }
        
        textarea.form-control {
            min-height: 200px;
            resize: vertical;
        }
        
        .alert {
            padding: 10px 15px;
            margin-top: 15px;
            border-radius: 4px;
            display: none;
        }
        
        .alert-success {
            background-color: #1c3c1c;
            color: #4caf50;
            border: 1px solid #2d4d2d;
        }
        
        .alert-error {
            background-color: #3c1c1c;
            color: #af4f4f;
            border: 1px solid #4d2d2d;
        }
        
        /* Hall of Autism */
        .hall-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .hall-item {
            background-color: #1a1a1a;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .hall-image {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }
        
        .hall-title {
            padding: 10px;
            text-align: center;
            font-size: 14px;
        }
        
        /* Auth forms */
        .auth-form {
            max-width: 400px;
            margin: 0 auto;
        }
        
        /* Account page */
        .profile-header {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .profile-image {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 20px;
            border: 2px solid #ff0000;
        }
        
        .friends-list {
            margin-top: 30px;
        }
        
        .friend-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background-color: #1a1a1a;
            margin-bottom: 10px;
            border-radius: 4px;
        }
        
        /* Chat modal */
        .chat-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 500px;
            background-color: #1a1a1a;
            border: 1px solid #333;
            border-radius: 4px;
            z-index: 1001;
            max-height: 80vh;
        }
        
        .chat-header {
            padding: 15px;
            background-color: #222;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #333;
        }
        
        .chat-messages {
            padding: 15px;
            height: 300px;
            overflow-y: auto;
        }
        
        .message {
            margin-bottom: 10px;
            padding: 8px 12px;
            border-radius: 4px;
            max-width: 80%;
        }
        
        .message.sent {
            background-color: #2c5282;
            margin-left: auto;
        }
        
        .message.received {
            background-color: #2d3748;
        }
        
        .chat-input {
            display: flex;
            padding: 10px;
            border-top: 1px solid #333;
        }
        
        .chat-input input {
            flex: 1;
            padding: 10px;
            background-color: #222;
            border: 1px solid #333;
            color: #fff;
            border-radius: 4px 0 0 4px;
        }
        
        .chat-input button {
            padding: 10px 15px;
            background-color: #ff0000;
            color: #fff;
            border: none;
            border-radius: 0 4px 4px 0;
            cursor: pointer;
        }
        
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="site-title">N0rb1n</div>
        <div class="online-indicator">
            <div class="dot"></div>
            <span id="online-count">0</span> online
        </div>
        <button class="menu-toggle" id="menu-toggle">â˜°</button>
    </nav>
    
    <!-- Dropdown Menu -->
    <div class="menu-container" id="menu-container">
        <ul class="menu">
            <li><a href="#" data-section="home">Home</a></li>
            <li><a href="#" data-section="paste">Paste</a></li>
            <li id="signin-item"><a href="#" data-section="signin">Sign In</a></li>
            <li id="login-item"><a href="#" data-section="login">Log In</a></li>
            <li id="account-item" style="display: none;"><a href="#" data-section="account">My Account</a></li>
            <li><a href="#" data-section="hall">Hall of Autism</a></li>
        </ul>
        <div class="device-info" id="device-info">
            Device: Detecting...
        </div>
    </div>
    
    <!-- Content Sections -->
    <main>
        <!-- Home Section -->
        <section id="home" class="content-section active">
            <div class="search-container">
                <input type="text" class="search-box" id="search-input" placeholder="Search pastes...">
            </div>
            
            <div class="search-results" id="search-results">
                <!-- Search results will appear here -->
            </div>
            
            <div class="recent-pastes" id="recent-pastes">
                <h2>Recent Pastes</h2>
                <div id="recent-pastes-list">
                    <!-- Recent pastes will appear here -->
                </div>
            </div>
        </section>
        
        <!-- Paste Creation Section -->
        <section id="paste" class="content-section">
            <h2>Create New Paste</h2>
            <form class="paste-form" id="paste-form">
                <div class="form-group">
                    <label for="paste-title">Title</label>
                    <input type="text" id="paste-title" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="paste-content">Content</label>
                    <textarea id="paste-content" class="form-control" required></textarea>
                </div>
                <div class="form-group">
                    <label for="paste-image">Image (URL or upload)</label>
                    <input type="file" id="paste-image-upload" accept="image/*" style="display: none;">
                    <input type="text" id="paste-image-url" class="form-control" placeholder="Image URL">
                    <button type="button" class="btn" id="upload-trigger" style="margin-top: 10px;">Upload Image</button>
                </div>
                <button type="submit" class="btn">Publish</button>
                <button type="button" class="btn" id="clear-paste" style="background-color: #333;">Clear</button>
                <div class="alert alert-success" id="paste-alert"></div>
            </form>
        </section>
        
        <!-- Sign In Section -->
        <section id="signin" class="content-section">
            <h2>Create Account</h2>
            <form class="auth-form" id="signin-form">
                <div class="form-group">
                    <label for="signin-username">Username</label>
                    <input type="text" id="signin-username" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="signin-password">Password</label>
                    <input type="password" id="signin-password" class="form-control" required>
                </div>
                <button type="submit" class="btn">Sign In</button>
                <div class="alert" id="signin-alert"></div>
            </form>
        </section>
        
        <!-- Log In Section -->
        <section id="login" class="content-section">
            <h2>Log In</h2>
            <form class="auth-form" id="login-form">
                <div class="form-group">
                    <label for="login-username">Username</label>
                    <input type="text" id="login-username" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="login-password">Password</label>
                    <input type="password" id="login-password" class="form-control" required>
                </div>
                <button type="submit" class="btn">Log In</button>
                <div class="alert" id="login-alert"></div>
            </form>
        </section>
        
        <!-- Account Section -->
        <section id="account" class="content-section">
            <div class="profile-header">
                <img src="" alt="Profile Image" class="profile-image" id="profile-image">
                <div>
                    <h2 id="account-username"></h2>
                    <input type="file" id="profile-image-upload" accept="image/*" style="display: none;">
                    <button class="btn" id="change-image-btn">Change Image</button>
                    <button class="btn" id="logout-btn" style="background-color: #333;">Log Out</button>
                </div>
            </div>
            
            <div class="friends-section">
                <h3>Friends</h3>
                <div class="form-group">
                    <input type="text" id="add-friend-input" class="form-control" placeholder="Username to add">
                    <button class="btn" id="add-friend-btn" style="margin-top: 10px;">Add Friend</button>
                </div>
                
                <h4>Friend Requests</h4>
                <div id="friend-requests">
                    <!-- Friend requests will appear here -->
                </div>
                
                <h4>Friend List</h4>
                <div id="friend-list">
                    <!-- Friends will appear here -->
                </div>
            </div>
        </section>
        
        <!-- Hall of Autism Section -->
        <section id="hall" class="content-section">
            <h2>Hall of Autism</h2>
            <p>Pastes that have been published more than 3 times with the same title</p>
            <div class="hall-grid" id="hall-grid">
                <!-- Hall of autism items will appear here -->
            </div>
        </section>
    </main>
    
    <!-- Chat Modal -->
    <div class="overlay" id="chat-overlay"></div>
    <div class="chat-modal" id="chat-modal">
        <div class="chat-header">
            <h3 id="chat-with-user">Chat with User</h3>
            <button class="btn" id="close-chat" style="background-color: #333;">Close</button>
        </div>
        <div class="chat-messages" id="chat-messages">
            <!-- Messages will appear here -->
        </div>
        <div class="chat-input">
            <input type="text" id="message-input" placeholder="Type your message...">
            <button id="send-message">Send</button>
        </div>
    </div>

    <script>
        // Global variables
        let currentUser = null;
        let onlineUsers = Math.floor(Math.random() * 50) + 10; // Random online users
        let pastes = JSON.parse(localStorage.getItem('n0rb1n_pastes')) || [];
        let users = JSON.parse(localStorage.getItem('n0rb1n_users')) || [];
        let currentChatFriend = null;
        
        // DOM elements
        const menuToggle = document.getElementById('menu-toggle');
        const menuContainer = document.getElementById('menu-container');
        const deviceInfo = document.getElementById('device-info');
        const onlineCount = document.getElementById('online-count');
        const contentSections = document.querySelectorAll('.content-section');
        const menuLinks = document.querySelectorAll('.menu a');
        const signinItem = document.getElementById('signin-item');
        const loginItem = document.getElementById('login-item');
        const accountItem = document.getElementById('account-item');
        
        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            // Set online users count
            onlineCount.textContent = onlineUsers;
            
            // Detect device
            detectDevice();
            
            // Check if user is logged in
            const savedUser = localStorage.getItem('n0rb1n_currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                updateAuthUI();
            }
            
            // Load recent pastes
            loadRecentPastes();
            
            // Load hall of autism
            loadHallOfAutism();
            
            // Set up event listeners
            setupEventListeners();
        });
        
        // Device detection
        function detectDevice() {
            const userAgent = navigator.userAgent;
            let device = 'desktop';
            
            if (/iPhone|iPad|iPod/i.test(userAgent)) {
                device = 'ios';
            } else if (/Android/i.test(userAgent)) {
                device = 'android';
            } else if (/VMware|VirtualBox|Xen|QEMU/i.test(userAgent)) {
                device = 'vm';
            } else if (/Mobile/i.test(userAgent)) {
                device = 'vp'; // virtual phone
            }
            
            deviceInfo.textContent = `Device: ${device}`;
        }
        
        // Menu toggle
        menuToggle.addEventListener('click', function() {
            menuContainer.classList.toggle('open');
        });
        
        // Close menu when clicking outside
        document.addEventListener('click', function(e) {
            if (!menuToggle.contains(e.target) && !menuContainer.contains(e.target)) {
                menuContainer.classList.remove('open');
            }
        });
        
        // Navigation
        menuLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const sectionId = this.getAttribute('data-section');
                
                // Hide all sections
                contentSections.forEach(section => {
                    section.classList.remove('active');
                });
                
                // Show selected section
                document.getElementById(sectionId).classList.add('active');
                
                // Close menu
                menuContainer.classList.remove('open');
                
                // Load section-specific content
                if (sectionId === 'home') {
                    loadRecentPastes();
                } else if (sectionId === 'hall') {
                    loadHallOfAutism();
                } else if (sectionId === 'account' && currentUser) {
                    loadAccountInfo();
                }
            });
        });
        
        // Search functionality
        const searchInput = document.getElementById('search-input');
        searchInput.addEventListener('input', function() {
            const query = this.value.trim().toLowerCase();
            const searchResults = document.getElementById('search-results');
            const recentPastes = document.getElementById('recent-pastes');
            
            if (query.length > 0) {
                recentPastes.style.display = 'none';
                searchResults.innerHTML = '';
                
                const filteredPastes = pastes.filter(paste => 
                    paste.title.toLowerCase().includes(query)
                );
                
                if (filteredPastes.length > 0) {
                    filteredPastes.forEach(paste => {
                        const pasteElement = createPasteElement(paste);
                        searchResults.appendChild(pasteElement);
                    });
                } else {
                    searchResults.innerHTML = '<p>No pastes found</p>';
                }
            } else {
                searchResults.innerHTML = '';
                recentPastes.style.display = 'block';
            }
        });
        
        // Create paste element for display
        function createPasteElement(paste) {
            const div = document.createElement('div');
            div.className = 'paste-item';
            
            const title = document.createElement('h3');
            title.className = 'paste-title';
            title.textContent = paste.title;
            
            const preview = document.createElement('div');
            preview.className = 'paste-preview';
            preview.textContent = paste.content.substring(0, 150) + '...';
            
            const viewBtn = document.createElement('button');
            viewBtn.className = 'btn';
            viewBtn.textContent = 'View Full Paste';
            viewBtn.addEventListener('click', function() {
                viewFullPaste(paste);
            });
            
            div.appendChild(title);
            div.appendChild(preview);
            div.appendChild(viewBtn);
            
            return div;
        }
        
        // View full paste
        function viewFullPaste(paste) {
            // Hide all sections
            contentSections.forEach(section => {
                section.classList.remove('active');
            });
            
            // Create a temporary section to display the full paste
            const fullPasteSection = document.createElement('div');
            fullPasteSection.className = 'content-section active';
            fullPasteSection.innerHTML = `
                <h2>${paste.title}</h2>
                <div style="margin-bottom: 20px;">
                    <button class="btn" id="back-to-home">Back to Home</button>
                </div>
                <div style="background-color: #1a1a1a; padding: 20px; border-radius: 4px; max-height: 70vh; overflow-y: auto;">
                    <pre style="white-space: pre-wrap; color: #fff;">${paste.content}</pre>
                    ${paste.image ? `<img src="${paste.image}" style="max-width: 100%; margin-top: 20px;">` : ''}
                </div>
            `;
            
            document.querySelector('main').appendChild(fullPasteSection);
            
            // Back button functionality
            document.getElementById('back-to-home').addEventListener('click', function() {
                fullPasteSection.remove();
                document.getElementById('home').classList.add('active');
            });
        }
        
        // Paste form submission
        document.getElementById('paste-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const title = document.getElementById('paste-title').value;
            const content = document.getElementById('paste-content').value;
            const imageUrl = document.getElementById('paste-image-url').value;
            
            const newPaste = {
                id: Date.now(),
                title,
                content,
                image: imageUrl,
                author: currentUser ? currentUser.username : 'Anonymous',
                timestamp: new Date().toISOString()
            };
            
            pastes.unshift(newPaste);
            localStorage.setItem('n0rb1n_pastes', JSON.stringify(pastes));
            
            // Show success message
            const alert = document.getElementById('paste-alert');
            alert.textContent = 'Paste created successfully!';
            alert.className = 'alert alert-success';
            alert.style.display = 'block';
            
            // Clear form
            this.reset();
            
            // Hide alert after 3 seconds
            setTimeout(() => {
                alert.style.display = 'none';
            }, 3000);
        });
        
        // Clear paste form
        document.getElementById('clear-paste').addEventListener('click', function() {
            document.getElementById('paste-form').reset();
        });
        
        // Image upload trigger
        document.getElementById('upload-trigger').addEventListener('click', function() {
            document.getElementById('paste-image-upload').click();
        });
        
        document.getElementById('paste-image-upload').addEventListener('change', function(e) {
            if (e.target.files && e.target.files[0]) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    document.getElementById('paste-image-url').value = event.target.result;
                };
                reader.readAsDataURL(e.target.files[0]);
            }
        });
        
        // Load recent pastes
        function loadRecentPastes() {
            const recentPastesList = document.getElementById('recent-pastes-list');
            recentPastesList.innerHTML = '';
            
            const recent = pastes.slice(0, 5);
            
            if (recent.length === 0) {
                recentPastesList.innerHTML = '<p>No pastes yet. Be the first to create one!</p>';
                return;
            }
            
            recent.forEach(paste => {
                const pasteElement = createPasteElement(paste);
                recentPastesList.appendChild(pasteElement);
            });
        }
        
        // Load hall of autism
        function loadHallOfAutism() {
            const hallGrid = document.getElementById('hall-grid');
            hallGrid.innerHTML = '';
            
            // Count occurrences of each title
            const titleCounts = {};
            pastes.forEach(paste => {
                if (titleCounts[paste.title]) {
                    titleCounts[paste.title]++;
                } else {
                    titleCounts[paste.title] = 1;
                }
            });
            
            // Filter titles that appear more than 3 times
            const popularTitles = Object.keys(titleCounts).filter(title => titleCounts[title] > 3);
            
            if (popularTitles.length === 0) {
                hallGrid.innerHTML = '<p>No pastes have achieved hall of autism status yet.</p>';
                return;
            }
            
            // Create items for the hall of autism
            popularTitles.forEach(title => {
                // Find the first paste with this title that has an image
                const pasteWithImage = pastes.find(p => p.title === title && p.image);
                
                if (pasteWithImage) {
                    const hallItem = document.createElement('div');
                    hallItem.className = 'hall-item';
                    
                    const image = document.createElement('img');
                    image.src = pasteWithImage.image;
                    image.alt = title;
                    image.className = 'hall-image';
                    
                    const titleElement = document.createElement('div');
                    titleElement.className = 'hall-title';
                    titleElement.textContent = title;
                    
                    hallItem.appendChild(image);
                    hallItem.appendChild(titleElement);
                    hallGrid.appendChild(hallItem);
                }
            });
        }
        
        // Sign in form
        document.getElementById('signin-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('signin-username').value;
            const password = document.getElementById('signin-password').value;
            
            // Check if username already exists
            if (users.find(user => user.username === username)) {
                const alert = document.getElementById('signin-alert');
                alert.textContent = 'Username already exists';
                alert.className = 'alert alert-error';
                alert.style.display = 'block';
                
                setTimeout(() => {
                    alert.style.display = 'none';
                }, 3000);
                return;
            }
            
            // Create new user
            const newUser = {
                username,
                password, // Note: In a real app, you should hash passwords!
                joined: new Date().toISOString(),
                friends: [],
                friendRequests: [],
                profileImage: ''
            };
            
            users.push(newUser);
            localStorage.setItem('n0rb1n_users', JSON.stringify(users));
            
            // Log the user in
            currentUser = newUser;
            localStorage.setItem('n0rb1n_currentUser', JSON.stringify(currentUser));
            
            // Update UI
            updateAuthUI();
            
            // Show success message
            const alert = document.getElementById('signin-alert');
            alert.textContent = 'Account created successfully!';
            alert.className = 'alert alert-success';
            alert.style.display = 'block';
            
            // Clear form
            this.reset();
            
            setTimeout(() => {
                alert.style.display = 'none';
            }, 3000);
        });
        
        // Log in form
        document.getElementById('login-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;
            
            // Find user
            const user = users.find(u => u.username === username);
            
            if (!user) {
                const alert = document.getElementById('login-alert');
                alert.textContent = 'Account does not exist';
                alert.className = 'alert alert-error';
                alert.style.display = 'block';
                
                setTimeout(() => {
                    alert.style.display = 'none';
                }, 3000);
                return;
            }
            
            // Check password
            if (user.password !== password) {
                const alert = document.getElementById('login-alert');
                alert.textContent = 'Incorrect password';
                alert.className = 'alert alert-error';
                alert.style.display = 'block';
                
                setTimeout(() => {
                    alert.style.display = 'none';
                }, 3000);
                return;
            }
            
            // Log the user in
            currentUser = user;
            localStorage.setItem('n0rb1n_currentUser', JSON.stringify(currentUser));
            
            // Update UI
            updateAuthUI();
            
            // Show success message
            const alert = document.getElementById('login-alert');
            alert.textContent = 'Logged in successfully!';
            alert.className = 'alert alert-success';
            alert.style.display = 'block';
            
            // Clear form
            this.reset();
            
            setTimeout(() => {
                alert.style.display = 'none';
            }, 3000);
        });
        
        // Update authentication UI
        function updateAuthUI() {
            if (currentUser) {
                // Hide sign in and log in, show account
                signinItem.style.display = 'none';
                loginItem.style.display = 'none';
                accountItem.style.display = 'list-item';
                
                // Update account info if on account page
                if (document.getElementById('account').classList.contains('active')) {
                    loadAccountInfo();
                }
            } else {
                // Show sign in and log in, hide account
                signinItem.style.display = 'list-item';
                loginItem.style.display = 'list-item';
                accountItem.style.display = 'none';
            }
        }
        
        // Load account info
        function loadAccountInfo() {
            if (!currentUser) return;
            
            document.getElementById('account-username').textContent = currentUser.username;
            
            // Load profile image if exists
            if (currentUser.profileImage) {
                document.getElementById('profile-image').src = currentUser.profileImage;
            } else {
                document.getElementById('profile-image').src = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj48cGF0aCBkPSJNMjAgMjF2LTJhNCA0IDAgMCAwLTQgNEg4YTQgNCAwIDAgMC00IDR2MiIvPjxjaXJjbGUgY3g9IjEyIiBjeT0iNyIgcj0iNCIvPjwvc3ZnPg==';
            }
            
            // Load friend requests
            loadFriendRequests();
            
            // Load friends list
            loadFriendsList();
        }
        
        // Change profile image
        document.getElementById('change-image-btn').addEventListener('click', function() {
            document.getElementById('profile-image-upload').click();
        });
        
        document.getElementById('profile-image-upload').addEventListener('change', function(e) {
            if (e.target.files && e.target.files[0]) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    // Update current user's profile image
                    currentUser.profileImage = event.target.result;
                    localStorage.setItem('n0rb1n_currentUser', JSON.stringify(currentUser));
                    
                    // Update in users list
                    const userIndex = users.findIndex(u => u.username === currentUser.username);
                    if (userIndex !== -1) {
                        users[userIndex].profileImage = event.target.result;
                        localStorage.setItem('n0rb1n_users', JSON.stringify(users));
                    }
                    
                    // Update UI
                    document.getElementById('profile-image').src = event.target.result;
                };
                reader.readAsDataURL(e.target.files[0]);
            }
        });
        
        // Log out
        document.getElementById('logout-btn').addEventListener('click', function() {
            currentUser = null;
            localStorage.removeItem('n0rb1n_currentUser');
            updateAuthUI();
            
            // Redirect to home
            contentSections.forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById('home').classList.add('active');
        });
        
        // Add friend
        document.getElementById('add-friend-btn').addEventListener('click', function() {
            const friendUsername = document.getElementById('add-friend-input').value.trim();
            
            if (!friendUsername) return;
            
            // Check if trying to add self
            if (friendUsername === currentUser.username) {
                alert("You can't add yourself as a friend!");
                return;
            }
            
            // Check if user exists
            const friendUser = users.find(u => u.username === friendUsername);
            if (!friendUser) {
                alert("User not found!");
                return;
            }
            
            // Check if already friends
            if (currentUser.friends && currentUser.friends.includes(friendUsername)) {
                alert("You're already friends with this user!");
                return;
            }
            
            // Check if already sent a request
            if (friendUser.friendRequests && friendUser.friendRequests.includes(currentUser.username)) {
                alert("You've already sent a friend request to this user!");
                return;
            }
            
            // Add friend request to target user
            if (!friendUser.friendRequests) {
                friendUser.friendRequests = [];
            }
            friendUser.friendRequests.push(currentUser.username);
            
            // Update users list
            const userIndex = users.findIndex(u => u.username === friendUsername);
            if (userIndex !== -1) {
                users[userIndex] = friendUser;
                localStorage.setItem('n0rb1n_users', JSON.stringify(users));
            }
            
            alert(`Friend request sent to ${friendUsername}!`);
            document.getElementById('add-friend-input').value = '';
        });
        
        // Load friend requests
        function loadFriendRequests() {
            const friendRequestsContainer = document.getElementById('friend-requests');
            friendRequestsContainer.innerHTML = '';
            
            if (!currentUser.friendRequests || currentUser.friendRequests.length === 0) {
                friendRequestsContainer.innerHTML = '<p>No friend requests</p>';
                return;
            }
            
            currentUser.friendRequests.forEach(request => {
                const requestElement = document.createElement('div');
                requestElement.className = 'friend-item';
                requestElement.innerHTML = `
                    <span>${request}</span>
                    <div>
                        <button class="btn accept-request" data-username="${request}">Accept</button>
                        <button class="btn deny-request" data-username="${request}" style="background-color: #333;">Deny</button>
                    </div>
                `;
                friendRequestsContainer.appendChild(requestElement);
            });
            
            // Add event listeners to accept/deny buttons
            document.querySelectorAll('.accept-request').forEach(btn => {
                btn.addEventListener('click', function() {
                    const username = this.getAttribute('data-username');
                    acceptFriendRequest(username);
                });
            });
            
            document.querySelectorAll('.deny-request').forEach(btn => {
                btn.addEventListener('click', function() {
                    const username = this.getAttribute('data-username');
                    denyFriendRequest(username);
                });
            });
        }
        
        // Accept friend request
        function acceptFriendRequest(username) {
            // Add to current user's friends
            if (!currentUser.friends) {
                currentUser.friends = [];
            }
            currentUser.friends.push(username);
            
            // Remove from requests
            currentUser.friendRequests = currentUser.friendRequests.filter(req => req !== username);
            
            // Add current user to the requester's friends
            const requester = users.find(u => u.username === username);
            if (requester) {
                if (!requester.friends) {
                    requester.friends = [];
                }
                requester.friends.push(currentUser.username);
                
                // Update requester in users list
                const requesterIndex = users.findIndex(u => u.username === username);
                if (requesterIndex !== -1) {
                    users[requesterIndex] = requester;
                }
            }
            
            // Update current user in storage
            localStorage.setItem('n0rb1n_currentUser', JSON.stringify(currentUser));
            
            // Update current user in users list
            const userIndex = users.findIndex(u => u.username === currentUser.username);
            if (userIndex !== -1) {
                users[userIndex] = currentUser;
                localStorage.setItem('n0rb1n_users', JSON.stringify(users));
            }
            
            // Reload account info
            loadAccountInfo();
        }
        
        // Deny friend request
        function denyFriendRequest(username) {
            // Remove from requests
            currentUser.friendRequests = currentUser.friendRequests.filter(req => req !== username);
            
            // Update current user in storage
            localStorage.setItem('n0rb1n_currentUser', JSON.stringify(currentUser));
            
            // Update current user in users list
            const userIndex = users.findIndex(u => u.username === currentUser.username);
            if (userIndex !== -1) {
                users[userIndex] = currentUser;
                localStorage.setItem('n0rb1n_users', JSON.stringify(users));
            }
            
            // Reload account info
            loadAccountInfo();
        }
        
        // Load friends list
        function loadFriendsList() {
            const friendListContainer = document.getElementById('friend-list');
            friendListContainer.innerHTML = '';
            
            if (!currentUser.friends || currentUser.friends.length === 0) {
                friendListContainer.innerHTML = '<p>No friends yet</p>';
                return;
            }
            
            currentUser.friends.forEach(friend => {
                const friendElement = document.createElement('div');
                friendElement.className = 'friend-item';
                friendElement.innerHTML = `
                    <span>${friend}</span>
                    <button class="btn chat-btn" data-username="${friend}">Chat now!</button>
                `;
                friendListContainer.appendChild(friendElement);
            });
            
            // Add event listeners to chat buttons
            document.querySelectorAll('.chat-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const username = this.getAttribute('data-username');
                    openChat(username);
                });
            });
        }
        
        // Open chat
        function openChat(username) {
            currentChatFriend = username;
            document.getElementById('chat-with-user').textContent = `Chat with ${username}`;
            document.getElementById('chat-messages').innerHTML = '';
            
            // Load chat messages
            loadChatMessages(username);
            
            // Show chat modal
            document.getElementById('chat-modal').style.display = 'block';
            document.getElementById('chat-overlay').style.display = 'block';
        }
        
        // Load chat messages
        function loadChatMessages(friendUsername) {
            const chatKey = `n0rb1n_chat_${getChatId(currentUser.username, friendUsername)}`;
            const messages = JSON.parse(localStorage.getItem(chatKey)) || [];
            
            const chatMessages = document.getElementById('chat-messages');
            chatMessages.innerHTML = '';
            
            messages.forEach(msg => {
                const messageElement = document.createElement('div');
                messageElement.className = `message ${msg.sender === currentUser.username ? 'sent' : 'received'}`;
                messageElement.textContent = msg.text;
                chatMessages.appendChild(messageElement);
            });
            
            // Scroll to bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        // Get chat ID (always the same for two users, regardless of order)
        function getChatId(user1, user2) {
            return [user1, user2].sort().join('_');
        }
        
        // Send message
        document.getElementById('send-message').addEventListener('click', function() {
            const messageInput = document.getElementById('message-input');
            const message = messageInput.value.trim();
            
            if (!message) return;
            
            // Create message object
            const newMessage = {
                sender: currentUser.username,
                text: message,
                timestamp: new Date().toISOString()
            };
            
            // Save message
            const chatKey = `n0rb1n_chat_${getChatId(currentUser.username, currentChatFriend)}`;
            const messages = JSON.parse(localStorage.getItem(chatKey)) || [];
            messages.push(newMessage);
            localStorage.setItem(chatKey, JSON.stringify(messages));
            
            // Add message to UI
            const messageElement = document.createElement('div');
            messageElement.className = 'message sent';
            messageElement.textContent = message;
            document.getElementById('chat-messages').appendChild(messageElement);
            
            // Clear input
            messageInput.value = '';
            
            // Scroll to bottom
            const chatMessages = document.getElementById('chat-messages');
            chatMessages.scrollTop = chatMessages.scrollHeight;
        });
        
        // Close chat
        document.getElementById('close-chat').addEventListener('click', function() {
            document.getElementById('chat-modal').style.display = 'none';
            document.getElementById('chat-overlay').style.display = 'none';
        });
        
        // Send message on Enter key
        document.getElementById('message-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('send-message').click();
            }
        });
        
        // Set up all event listeners
        function setupEventListeners() {
            // Already set up in individual sections
        }
    </script>
</body>
</html>
