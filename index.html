<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>N0rb1n</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Courier New', monospace;
        }
        
        body {
            background-color: #0a0a0a;
            color: #fff;
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        /* Header and Navigation */
        .header {
            background-color: #111;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #ff0000;
            box-shadow: 0 0 15px rgba(255, 0, 0, 0.5);
            position: relative;
            z-index: 1000;
        }
        
        .site-title {
            font-size: 28px;
            font-weight: bold;
            color: #ff0000;
            text-shadow: 0 0 10px #ff0000, 0 0 20px #ff0000, 0 0 30px #ff0000;
            animation: glow 1.5s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from {
                text-shadow: 0 0 5px #ff0000, 0 0 10px #ff0000;
            }
            to {
                text-shadow: 0 0 15px #ff0000, 0 0 20px #ff0000, 0 0 30px #ff0000;
            }
        }
        
        .online-indicator {
            display: flex;
            align-items: center;
            margin-left: 20px;
        }
        
        .dot {
            width: 12px;
            height: 12px;
            background-color: #00ff00;
            border-radius: 50%;
            margin-right: 8px;
            box-shadow: 0 0 8px #00ff00;
        }
        
        .online-count {
            font-size: 16px;
            color: #00ff00;
        }
        
        .menu-toggle {
            background: none;
            border: none;
            color: #fff;
            font-size: 24px;
            cursor: pointer;
        }
        
        .menu {
            position: fixed;
            top: -300px;
            left: 0;
            width: 100%;
            background-color: #1a1a1a;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            transition: top 0.5s ease;
            z-index: 999;
        }
        
        .menu.open {
            top: 60px;
        }
        
        .menu-categories {
            list-style: none;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .menu-categories li {
            margin-right: 20px;
        }
        
        .menu-categories a {
            color: #fff;
            text-decoration: none;
            font-size: 18px;
            padding: 8px 12px;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        
        .menu-categories a:hover {
            background-color: #ff0000;
        }
        
        .device-info {
            font-size: 14px;
            color: #aaa;
            padding: 10px;
            background-color: #222;
            border-radius: 4px;
        }
        
        /* Main Content */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .section {
            display: none;
            padding: 20px;
            background-color: #1a1a1a;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .section.active {
            display: block;
        }
        
        /* Home Section */
        .search-container {
            margin-bottom: 30px;
        }
        
        .search-box {
            display: flex;
            margin-bottom: 20px;
        }
        
        .search-input {
            flex: 1;
            padding: 12px;
            border: 1px solid #333;
            background-color: #111;
            color: #fff;
            border-radius: 4px 0 0 4px;
        }
        
        .search-button {
            padding: 12px 20px;
            background-color: #ff0000;
            color: #fff;
            border: none;
            border-radius: 0 4px 4px 0;
            cursor: pointer;
        }
        
        .recent-pastes {
            margin-top: 30px;
        }
        
        .paste-list {
            list-style: none;
        }
        
        .paste-item {
            padding: 15px;
            background-color: #222;
            margin-bottom: 10px;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .paste-title {
            font-size: 18px;
            font-weight: bold;
        }
        
        .paste-actions button {
            padding: 8px 15px;
            background-color: #333;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 10px;
        }
        
        .paste-preview {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background-color: #222;
            border-radius: 4px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        /* Paste Creation Section */
        .paste-form {
            display: flex;
            flex-direction: column;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }
        
        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #333;
            background-color: #111;
            color: #fff;
            border-radius: 4px;
        }
        
        .form-group textarea {
            min-height: 200px;
            resize: vertical;
        }
        
        .form-buttons {
            display: flex;
            gap: 10px;
        }
        
        .publish-button,
        .clear-button {
            padding: 12px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .publish-button {
            background-color: #ff0000;
            color: #fff;
        }
        
        .clear-button {
            background-color: #333;
            color: #fff;
        }
        
        .alert {
            margin-top: 20px;
            padding: 12px;
            border-radius: 4px;
            display: none;
        }
        
        .alert-success {
            background-color: #004d00;
            color: #00ff00;
        }
        
        .alert-error {
            background-color: #4d0000;
            color: #ff6666;
        }
        
        /* Hall of Autism Section */
        .hall-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .hall-item {
            background-color: #222;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .hall-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }
        
        .hall-title {
            padding: 15px;
            font-weight: bold;
            text-align: center;
        }
        
        /* Account Section */
        .account-form {
            max-width: 500px;
            margin: 0 auto;
        }
        
        .profile-container {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .profile-image {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 20px;
            border: 2px solid #ff0000;
        }
        
        .profile-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .friends-section {
            margin-top: 30px;
        }
        
        .friend-list {
            list-style: none;
            margin-top: 15px;
        }
        
        .friend-item {
            padding: 15px;
            background-color: #222;
            margin-bottom: 10px;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .chat-container {
            margin-top: 20px;
            border: 1px solid #333;
            border-radius: 4px;
            padding: 15px;
            background-color: #222;
        }
        
        .chat-messages {
            height: 300px;
            overflow-y: auto;
            margin-bottom: 15px;
            padding: 10px;
            background-color: #111;
            border-radius: 4px;
        }
        
        .message {
            margin-bottom: 10px;
            padding: 8px 12px;
            border-radius: 4px;
            max-width: 80%;
        }
        
        .message.sent {
            background-color: #004d00;
            margin-left: auto;
        }
        
        .message.received {
            background-color: #333;
        }
        
        .chat-input {
            display: flex;
        }
        
        .chat-input input {
            flex: 1;
            padding: 12px;
            border: 1px solid #333;
            background-color: #111;
            color: #fff;
            border-radius: 4px 0 0 4px;
        }
        
        .chat-input button {
            padding: 12px 20px;
            background-color: #ff0000;
            color: #fff;
            border: none;
            border-radius: 0 4px 4px 0;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <!-- Header with glowing title and online indicator -->
    <header class="header">
        <div class="site-title">N0rb1n</div>
        <div class="online-indicator">
            <div class="dot"></div>
            <span class="online-count">0</span>
        </div>
        <button class="menu-toggle">â˜°</button>
    </header>
    
    <!-- Sliding menu -->
    <nav class="menu">
        <ul class="menu-categories">
            <li><a href="#" data-section="home">Home</a></li>
            <li><a href="#" data-section="paste">Paste</a></li>
            <li><a href="#" data-section="signin" id="signin-link">Sign In</a></li>
            <li><a href="#" data-section="login" id="login-link">Log In</a></li>
            <li><a href="#" data-section="account" id="account-link" style="display: none;">My Account</a></li>
            <li><a href="#" data-section="hall">Hall of Autism</a></li>
        </ul>
        <div class="device-info">
            Device: <span id="device-type">Detecting...</span>
        </div>
    </nav>
    
    <!-- Main content container -->
    <main class="container">
        <!-- Home Section -->
        <section id="home" class="section active">
            <div class="search-container">
                <div class="search-box">
                    <input type="text" class="search-input" placeholder="Search pastes...">
                    <button class="search-button">Search</button>
                </div>
                <div id="search-results"></div>
                <div id="paste-preview" class="paste-preview"></div>
            </div>
            
            <div class="recent-pastes">
                <h2>Recent Pastes</h2>
                <ul class="paste-list" id="recent-pastes-list">
                    <!-- Recent pastes will be populated here -->
                </ul>
            </div>
        </section>
        
        <!-- Paste Creation Section -->
        <section id="paste" class="section">
            <h2>Create New Paste</h2>
            <div class="paste-form">
                <div class="form-group">
                    <label for="paste-title">Title</label>
                    <input type="text" id="paste-title" placeholder="Enter title">
                </div>
                <div class="form-group">
                    <label for="paste-content">Content</label>
                    <textarea id="paste-content" placeholder="Enter your paste content"></textarea>
                </div>
                <div class="form-group">
                    <label for="paste-image">Image (URL or upload)</label>
                    <input type="text" id="paste-image-url" placeholder="Enter image URL">
                    <input type="file" id="paste-image-upload" accept="image/*">
                </div>
                <div class="form-buttons">
                    <button class="publish-button" id="publish-paste">Publish</button>
                    <button class="clear-button" id="clear-paste">Clear</button>
                </div>
                <div class="alert" id="paste-alert"></div>
            </div>
        </section>
        
        <!-- Sign In Section -->
        <section id="signin" class="section">
            <h2>Create Account</h2>
            <div class="account-form">
                <div class="form-group">
                    <label for="signin-username">Username</label>
                    <input type="text" id="signin-username" placeholder="Choose a username">
                </div>
                <div class="form-group">
                    <label for="signin-password">Password</label>
                    <input type="password" id="signin-password" placeholder="Choose a password">
                </div>
                <button class="publish-button" id="signin-button">Sign In</button>
                <div class="alert" id="signin-alert"></div>
            </div>
        </section>
        
        <!-- Log In Section -->
        <section id="login" class="section">
            <h2>Log In</h2>
            <div class="account-form">
                <div class="form-group">
                    <label for="login-username">Username</label>
                    <input type="text" id="login-username" placeholder="Enter your username">
                </div>
                <div class="form-group">
                    <label for="login-password">Password</label>
                    <input type="password" id="login-password" placeholder="Enter your password">
                </div>
                <button class="publish-button" id="login-button">Log In</button>
                <div class="alert" id="login-alert"></div>
            </div>
        </section>
        
        <!-- My Account Section -->
        <section id="account" class="section">
            <h2>My Account</h2>
            <div class="profile-container">
                <img src="" alt="Profile Image" class="profile-image" id="profile-image">
                <div class="profile-actions">
                    <input type="file" id="profile-image-upload" accept="image/*">
                    <input type="text" id="profile-image-url" placeholder="Or enter image URL">
                    <button class="publish-button" id="update-profile-image">Update Image</button>
                </div>
            </div>
            
            <button class="publish-button" id="logout-button">Log Out</button>
            
            <div class="friends-section">
                <h3>Friends</h3>
                <div class="form-group">
                    <input type="text" id="add-friend-input" placeholder="Enter username">
                    <button class="publish-button" id="add-friend-button">Add Friend</button>
                </div>
                
                <h4>Friend Requests</h4>
                <ul class="friend-list" id="friend-requests-list">
                    <!-- Friend requests will appear here -->
                </ul>
                
                <h4>Friend List</h4>
                <ul class="friend-list" id="friends-list">
                    <!-- Friends will appear here -->
                </ul>
            </div>
            
            <div class="chat-container" id="chat-container" style="display: none;">
                <h4>Chat with <span id="chat-friend-name"></span></h4>
                <div class="chat-messages" id="chat-messages">
                    <!-- Chat messages will appear here -->
                </div>
                <div class="chat-input">
                    <input type="text" id="chat-input" placeholder="Type your message...">
                    <button id="send-message">Send</button>
                </div>
            </div>
        </section>
        
        <!-- Hall of Autism Section -->
        <section id="hall" class="section">
            <h2>Hall of Autism</h2>
            <p>Pastes that have been published more than 3 times with the same title</p>
            <div class="hall-container" id="hall-container">
                <!-- Hall of autism items will be populated here -->
            </div>
        </section>
    </main>

    <script>
        // Global variables
        let currentUser = null;
        let onlineUsers = 0;
        let pastes = JSON.parse(localStorage.getItem('n0rb1n_pastes')) || [];
        let users = JSON.parse(localStorage.getItem('n0rb1n_users')) || [];
        let currentChatFriend = null;
        
        // DOM Elements
        const menuToggle = document.querySelector('.menu-toggle');
        const menu = document.querySelector('.menu');
        const onlineCount = document.querySelector('.online-count');
        const deviceType = document.getElementById('device-type');
        const sections = document.querySelectorAll('.section');
        const sectionLinks = document.querySelectorAll('.menu-categories a');
        const signinLink = document.getElementById('signin-link');
        const loginLink = document.getElementById('login-link');
        const accountLink = document.getElementById('account-link');
        
        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            // Detect device type
            detectDevice();
            
            // Update online users (random for demo)
            updateOnlineUsers();
            
            // Load recent pastes
            loadRecentPastes();
            
            // Load hall of autism
            loadHallOfAutism();
            
            // Check if user is logged in
            checkLoggedIn();
            
            // Set up event listeners
            setupEventListeners();
        });
        
        // Device detection
        function detectDevice() {
            const userAgent = navigator.userAgent;
            
            if (/android/i.test(userAgent)) {
                deviceType.textContent = 'Android';
            } else if (/iPad|iPhone|iPod/.test(userAgent)) {
                deviceType.textContent = 'iOS';
            } else if (/Win/.test(userAgent)) {
                deviceType.textContent = 'Desktop (Windows)';
            } else if (/Mac/.test(userAgent)) {
                deviceType.textContent = 'Desktop (Mac)';
            } else if (/Linux/.test(userAgent)) {
                deviceType.textContent = 'Desktop (Linux)';
            } else if (/VMware|VirtualBox|Xen/.test(userAgent)) {
                deviceType.textContent = 'Virtual Machine';
            } else {
                deviceType.textContent = 'Unknown';
            }
        }
        
        // Update online users (simulated)
        function updateOnlineUsers() {
            onlineUsers = Math.floor(Math.random() * 100) + 50;
            onlineCount.textContent = onlineUsers;
            
            // Update every 30 seconds
            setTimeout(updateOnlineUsers, 30000);
        }
        
        // Toggle menu
        menuToggle.addEventListener('click', function() {
            menu.classList.toggle('open');
        });
        
        // Switch sections
        sectionLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const sectionId = this.getAttribute('data-section');
                
                // Hide all sections
                sections.forEach(section => {
                    section.classList.remove('active');
                });
                
                // Show selected section
                document.getElementById(sectionId).classList.add('active');
                
                // Close menu
                menu.classList.remove('open');
                
                // If home section, reload recent pastes if search is empty
                if (sectionId === 'home') {
                    const searchInput = document.querySelector('.search-input');
                    if (!searchInput.value.trim()) {
                        loadRecentPastes();
                    }
                }
            });
        });
        
        // Load recent pastes
        function loadRecentPastes() {
            const recentPastesList = document.getElementById('recent-pastes-list');
            recentPastesList.innerHTML = '';
            
            // Get the 10 most recent pastes
            const recentPastes = [...pastes].sort((a, b) => new Date(b.date) - new Date(a.date)).slice(0, 10);
            
            if (recentPastes.length === 0) {
                recentPastesList.innerHTML = '<li class="paste-item">No pastes yet. Be the first to create one!</li>';
                return;
            }
            
            recentPastes.forEach(paste => {
                const li = document.createElement('li');
                li.className = 'paste-item';
                li.innerHTML = `
                    <div class="paste-title">${paste.title}</div>
                    <div class="paste-actions">
                        <button class="view-paste" data-id="${paste.id}">View</button>
                    </div>
                `;
                recentPastesList.appendChild(li);
            });
            
            // Add event listeners to view buttons
            document.querySelectorAll('.view-paste').forEach(button => {
                button.addEventListener('click', function() {
                    const pasteId = this.getAttribute('data-id');
                    viewPaste(pasteId);
                });
            });
        }
        
        // View a paste
        function viewPaste(id) {
            const paste = pastes.find(p => p.id === id);
            if (!paste) return;
            
            const preview = document.getElementById('paste-preview');
            preview.style.display = 'block';
            preview.innerHTML = `
                <h3>${paste.title}</h3>
                <p>By: ${paste.author || 'Anonymous'}</p>
                <div>${formatPasteContent(paste.content)}</div>
                ${paste.image ? `<img src="${paste.image}" alt="Paste image" style="max-width: 100%; margin-top: 15px;">` : ''}
            `;
            
            // Hide recent pastes
            document.getElementById('recent-pastes-list').innerHTML = '';
        }
        
        // Format paste content (simple formatting for demo)
        function formatPasteContent(content) {
            return content.replace(/\n/g, '<br>');
        }
        
        // Search functionality
        const searchInput = document.querySelector('.search-input');
        const searchButton = document.querySelector('.search-button');
        
        searchButton.addEventListener('click', searchPastes);
        searchInput.addEventListener('keyup', function(e) {
            if (e.key === 'Enter') {
                searchPastes();
            }
        });
        
        function searchPastes() {
            const query = searchInput.value.trim().toLowerCase();
            const resultsContainer = document.getElementById('search-results');
            const preview = document.getElementById('paste-preview');
            preview.style.display = 'none';
            
            if (!query) {
                loadRecentPastes();
                resultsContainer.innerHTML = '';
                return;
            }
            
            // Filter pastes by title
            const results = pastes.filter(paste => 
                paste.title.toLowerCase().includes(query)
            );
            
            // Hide recent pastes
            document.getElementById('recent-pastes-list').innerHTML = '';
            
            if (results.length === 0) {
                resultsContainer.innerHTML = '<div class="paste-item">No pastes found.</div>';
                return;
            }
            
            resultsContainer.innerHTML = '<h3>Search Results</h3>';
            
            results.forEach(paste => {
                const div = document.createElement('div');
                div.className = 'paste-item';
                div.innerHTML = `
                    <div class="paste-title">${paste.title}</div>
                    <div class="paste-actions">
                        <button class="view-paste" data-id="${paste.id}">View</button>
                    </div>
                `;
                resultsContainer.appendChild(div);
            });
            
            // Add event listeners to view buttons
            document.querySelectorAll('.view-paste').forEach(button => {
                button.addEventListener('click', function() {
                    const pasteId = this.getAttribute('data-id');
                    viewPaste(pasteId);
                });
            });
        }
        
        // Paste creation
        const publishButton = document.getElementById('publish-paste');
        const clearButton = document.getElementById('clear-paste');
        const pasteAlert = document.getElementById('paste-alert');
        
        publishButton.addEventListener('click', function() {
            const title = document.getElementById('paste-title').value.trim();
            const content = document.getElementById('paste-content').value.trim();
            const imageUrl = document.getElementById('paste-image-url').value.trim();
            const imageFile = document.getElementById('paste-image-upload').files[0];
            
            if (!title || !content) {
                showAlert(pasteAlert, 'Title and content are required', 'error');
                return;
            }
            
            // For demo purposes, we'll just use the URL if provided
            // In a real application, you would upload the image file to a server
            let image = imageUrl;
            
            const newPaste = {
                id: generateId(),
                title,
                content,
                image,
                author: currentUser ? currentUser.username : 'Anonymous',
                date: new Date().toISOString()
            };
            
            pastes.push(newPaste);
            localStorage.setItem('n0rb1n_pastes', JSON.stringify(pastes));
            
            showAlert(pasteAlert, 'Paste published successfully!', 'success');
            
            // Clear form
            document.getElementById('paste-title').value = '';
            document.getElementById('paste-content').value = '';
            document.getElementById('paste-image-url').value = '';
            document.getElementById('paste-image-upload').value = '';
            
            // Reload hall of autism
            loadHallOfAutism();
        });
        
        clearButton.addEventListener('click', function() {
            document.getElementById('paste-title').value = '';
            document.getElementById('paste-content').value = '';
            document.getElementById('paste-image-url').value = '';
            document.getElementById('paste-image-upload').value = '';
        });
        
        // Load Hall of Autism
        function loadHallOfAutism() {
            const hallContainer = document.getElementById('hall-container');
            hallContainer.innerHTML = '';
            
            // Count occurrences of each title
            const titleCounts = {};
            pastes.forEach(paste => {
                titleCounts[paste.title] = (titleCounts[paste.title] || 0) + 1;
            });
            
            // Filter titles that appear more than 3 times
            const popularTitles = Object.keys(titleCounts).filter(title => titleCounts[title] > 3);
            
            if (popularTitles.length === 0) {
                hallContainer.innerHTML = '<div class="paste-item">No pastes in the Hall of Autism yet.</div>';
                return;
            }
            
            // For each popular title, get the first paste that has an image
            popularTitles.forEach(title => {
                const pasteWithImage = pastes.find(p => p.title === title && p.image);
                if (pasteWithImage) {
                    const div = document.createElement('div');
                    div.className = 'hall-item';
                    div.innerHTML = `
                        <img src="${pasteWithImage.image}" alt="${title}" class="hall-image">
                        <div class="hall-title">${title}</div>
                    `;
                    hallContainer.appendChild(div);
                }
            });
        }
        
        // Account system
        const signinButton = document.getElementById('signin-button');
        const signinAlert = document.getElementById('signin-alert');
        const loginButton = document.getElementById('login-button');
        const loginAlert = document.getElementById('login-alert');
        const logoutButton = document.getElementById('logout-button');
        
        function checkLoggedIn() {
            const savedUser = localStorage.getItem('n0rb1n_current_user');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                updateUserInterface();
            }
        }
        
        signinButton.addEventListener('click', function() {
            const username = document.getElementById('signin-username').value.trim();
            const password = document.getElementById('signin-password').value.trim();
            
            if (!username || !password) {
                showAlert(signinAlert, 'Username and password are required', 'error');
                return;
            }
            
            // Check if user already exists
            if (users.find(user => user.username === username)) {
                showAlert(signinAlert, 'Username already exists', 'error');
                return;
            }
            
            const newUser = {
                id: generateId(),
                username,
                password, // In a real application, you would hash the password
                friends: [],
                friendRequests: [],
                profileImage: ''
            };
            
            users.push(newUser);
            localStorage.setItem('n0rb1n_users', JSON.stringify(users));
            
            // Log the user in
            currentUser = newUser;
            localStorage.setItem('n0rb1n_current_user', JSON.stringify(currentUser));
            
            showAlert(signinAlert, 'Account created successfully!', 'success');
            updateUserInterface();
            
            // Clear form
            document.getElementById('signin-username').value = '';
            document.getElementById('signin-password').value = '';
        });
        
        loginButton.addEventListener('click', function() {
            const username = document.getElementById('login-username').value.trim();
            const password = document.getElementById('login-password').value.trim();
            
            if (!username || !password) {
                showAlert(loginAlert, 'Username and password are required', 'error');
                return;
            }
            
            // Find user
            const user = users.find(u => u.username === username);
            
            if (!user) {
                showAlert(loginAlert, 'User does not exist', 'error');
                return;
            }
            
            if (user.password !== password) {
                showAlert(loginAlert, 'Incorrect password', 'error');
                return;
            }
            
            // Log the user in
            currentUser = user;
            localStorage.setItem('n0rb1n_current_user', JSON.stringify(currentUser));
            
            showAlert(loginAlert, 'Logged in successfully!', 'success');
            updateUserInterface();
            
            // Clear form
            document.getElementById('login-username').value = '';
            document.getElementById('login-password').value = '';
        });
        
        logoutButton.addEventListener('click', function() {
            currentUser = null;
            localStorage.removeItem('n0rb1n_current_user');
            updateUserInterface();
        });
        
        function updateUserInterface() {
            if (currentUser) {
                // User is logged in
                signinLink.style.display = 'none';
                loginLink.style.display = 'none';
                accountLink.style.display = 'block';
                
                // Update profile image if available
                const profileImage = document.getElementById('profile-image');
                if (currentUser.profileImage) {
                    profileImage.src = currentUser.profileImage;
                } else {
                    profileImage.src = '';
                }
                
                // Load friends and friend requests
                loadFriends();
                loadFriendRequests();
            } else {
                // User is not logged in
                signinLink.style.display = 'block';
                loginLink.style.display = 'block';
                accountLink.style.display = 'none';
            }
        }
        
        // Profile image update
        const updateProfileImageButton = document.getElementById('update-profile-image');
        
        updateProfileImageButton.addEventListener('click', function() {
            const imageUrl = document.getElementById('profile-image-url').value.trim();
            const imageFile = document.getElementById('profile-image-upload').files[0];
            
            // For demo, just use the URL
            if (imageUrl) {
                currentUser.profileImage = imageUrl;
                
                // Update in users array
                const userIndex = users.findIndex(u => u.id === currentUser.id);
                if (userIndex !== -1) {
                    users[userIndex].profileImage = imageUrl;
                    localStorage.setItem('n0rb1n_users', JSON.stringify(users));
                }
                
                localStorage.setItem('n0rb1n_current_user', JSON.stringify(currentUser));
                
                // Update profile image display
                document.getElementById('profile-image').src = imageUrl;
                
                // Clear form
                document.getElementById('profile-image-url').value = '';
                document.getElementById('profile-image-upload').value = '';
            }
        });
        
        // Friends system
        const addFriendButton = document.getElementById('add-friend-button');
        
        addFriendButton.addEventListener('click', function() {
            const friendUsername = document.getElementById('add-friend-input').value.trim();
            
            if (!friendUsername) {
                alert('Please enter a username');
                return;
            }
            
            // Check if trying to add self
            if (friendUsername === currentUser.username) {
                alert('You cannot add yourself as a friend');
                return;
            }
            
            // Find friend user
            const friendUser = users.find(u => u.username === friendUsername);
            
            if (!friendUser) {
                alert('User not found');
                return;
            }
            
            // Check if already friends
            if (currentUser.friends.includes(friendUser.id)) {
                alert('This user is already your friend');
                return;
            }
            
            // Check if already sent a request
            if (friendUser.friendRequests && friendUser.friendRequests.includes(currentUser.id)) {
                alert('Friend request already sent');
                return;
            }
            
            // Add friend request to target user
            if (!friendUser.friendRequests) {
                friendUser.friendRequests = [];
            }
            
            friendUser.friendRequests.push(currentUser.id);
            
            // Update users in localStorage
            const userIndex = users.findIndex(u => u.id === friendUser.id);
            if (userIndex !== -1) {
                users[userIndex] = friendUser;
                localStorage.setItem('n0rb1n_users', JSON.stringify(users));
            }
            
            alert('Friend request sent');
            document.getElementById('add-friend-input').value = '';
        });
        
        function loadFriends() {
            const friendsList = document.getElementById('friends-list');
            friendsList.innerHTML = '';
            
            if (!currentUser.friends || currentUser.friends.length === 0) {
                friendsList.innerHTML = '<li class="friend-item">No friends yet.</li>';
                return;
            }
            
            currentUser.friends.forEach(friendId => {
                const friend = users.find(u => u.id === friendId);
                if (friend) {
                    const li = document.createElement('li');
                    li.className = 'friend-item';
                    li.innerHTML = `
                        <div>${friend.username}</div>
                        <button class="chat-button" data-friend="${friend.id}">Chat Now!</button>
                    `;
                    friendsList.appendChild(li);
                }
            });
            
            // Add event listeners to chat buttons
            document.querySelectorAll('.chat-button').forEach(button => {
                button.addEventListener('click', function() {
                    const friendId = this.getAttribute('data-friend');
                    startChat(friendId);
                });
            });
        }
        
        function loadFriendRequests() {
            const friendRequestsList = document.getElementById('friend-requests-list');
            friendRequestsList.innerHTML = '';
            
            if (!currentUser.friendRequests || currentUser.friendRequests.length === 0) {
                friendRequestsList.innerHTML = '<li class="friend-item">No friend requests.</li>';
                return;
            }
            
            currentUser.friendRequests.forEach(requestId => {
                const requester = users.find(u => u.id === requestId);
                if (requester) {
                    const li = document.createElement('li');
                    li.className = 'friend-item';
                    li.innerHTML = `
                        <div>${requester.username}</div>
                        <div>
                            <button class="accept-request" data-friend="${requester.id}">Accept</button>
                            <button class="deny-request" data-friend="${requester.id}">Deny</button>
                        </div>
                    `;
                    friendRequestsList.appendChild(li);
                }
            });
            
            // Add event listeners to accept/deny buttons
            document.querySelectorAll('.accept-request').forEach(button => {
                button.addEventListener('click', function() {
                    const friendId = this.getAttribute('data-friend');
                    respondToFriendRequest(friendId, true);
                });
            });
            
            document.querySelectorAll('.deny-request').forEach(button => {
                button.addEventListener('click', function() {
                    const friendId = this.getAttribute('data-friend');
                    respondToFriendRequest(friendId, false);
                });
            });
        }
        
        function respondToFriendRequest(friendId, accept) {
            // Remove from current user's requests
            currentUser.friendRequests = currentUser.friendRequests.filter(id => id !== friendId);
            
            if (accept) {
                // Add to friends list
                if (!currentUser.friends) {
                    currentUser.friends = [];
                }
                currentUser.friends.push(friendId);
                
                // Add current user to friend's friends list
                const friend = users.find(u => u.id === friendId);
                if (friend) {
                    if (!friend.friends) {
                        friend.friends = [];
                    }
                    friend.friends.push(currentUser.id);
                    
                    // Update friend in users array
                    const friendIndex = users.findIndex(u => u.id === friendId);
                    if (friendIndex !== -1) {
                        users[friendIndex] = friend;
                    }
                }
            }
            
            // Update current user in users array
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                users[userIndex] = currentUser;
            }
            
            // Save to localStorage
            localStorage.setItem('n0rb1n_users', JSON.stringify(users));
            localStorage.setItem('n0rb1n_current_user', JSON.stringify(currentUser));
            
            // Reload friends and requests
            loadFriends();
            loadFriendRequests();
        }
        
        // Chat system
        function startChat(friendId) {
            const friend = users.find(u => u.id === friendId);
            if (!friend) return;
            
            currentChatFriend = friend;
            
            const chatContainer = document.getElementById('chat-container');
            const chatFriendName = document.getElementById('chat-friend-name');
            const chatMessages = document.getElementById('chat-messages');
            
            chatFriendName.textContent = friend.username;
            chatContainer.style.display = 'block';
            chatMessages.innerHTML = '';
            
            // Load chat messages
            loadChatMessages(friendId);
            
            // Scroll to bottom of chat
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        function loadChatMessages(friendId) {
            const chatMessages = document.getElementById('chat-messages');
            chatMessages.innerHTML = '';
            
            // Get messages from localStorage
            const chatKey = getChatKey(currentUser.id, friendId);
            const messages = JSON.parse(localStorage.getItem(chatKey)) || [];
            
            if (messages.length === 0) {
                chatMessages.innerHTML = '<div class="message">No messages yet. Start the conversation!</div>';
                return;
            }
            
            messages.forEach(message => {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${message.sender === currentUser.id ? 'sent' : 'received'}`;
                messageDiv.textContent = message.text;
                chatMessages.appendChild(messageDiv);
            });
        }
        
        const sendMessageButton = document.getElementById('send-message');
        const chatInput = document.getElementById('chat-input');
        
        sendMessageButton.addEventListener('click', sendMessage);
        chatInput.addEventListener('keyup', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
        
        function sendMessage() {
            if (!currentChatFriend) return;
            
            const messageText = chatInput.value.trim();
            if (!messageText) return;
            
            // Create message
            const message = {
                sender: currentUser.id,
                receiver: currentChatFriend.id,
                text: messageText,
                timestamp: new Date().toISOString()
            };
            
            // Save message to localStorage
            const chatKey = getChatKey(currentUser.id, currentChatFriend.id);
            const messages = JSON.parse(localStorage.getItem(chatKey)) || [];
            messages.push(message);
            localStorage.setItem(chatKey, JSON.stringify(messages));
            
            // Add message to chat
            const chatMessages = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message sent';
            messageDiv.textContent = messageText;
            chatMessages.appendChild(messageDiv);
            
            // Clear input and scroll to bottom
            chatInput.value = '';
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        function getChatKey(userId1, userId2) {
            // Create a consistent key regardless of order
            const ids = [userId1, userId2].sort();
            return `n0rb1n_chat_${ids[0]}_${ids[1]}`;
        }
        
        // Utility functions
        function generateId() {
            return Math.random().toString(36).substr(2, 9);
        }
        
        function showAlert(alertElement, message, type) {
            alertElement.textContent = message;
            alertElement.className = `alert alert-${type}`;
            alertElement.style.display = 'block';
            
            setTimeout(() => {
                alertElement.style.display = 'none';
            }, 3000);
        }
        
        function setupEventListeners() {
            // Additional event listeners can be added here if needed
        }
    </script>
</body>
</html>
